<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لوحة الإدارة — صيدات العود</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&family=Tajawal:wght@500;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/buttons.css">
  <link rel="stylesheet" href="css/forms.css">
  <link rel="stylesheet" href="css/badges.css">
  <link rel="stylesheet" href="css/dashboard.css">
  <link rel="stylesheet" href="css/admin.css">
</head>
<body>

  <!-- Sidebar Overlay (mobile) -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

  <!-- Mobile Toggle -->
  <button class="sidebar-fab" id="sidebarFab" onclick="toggleSidebar()">
    <svg viewBox="0 0 24 24" width="24" height="24" fill="#fff"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
  </button>

  <div class="dashboard-layout">
    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-brand">
        <a href="index.html" style="text-decoration:none;color:inherit;">
          <span class="brand-icon">
            <svg viewBox="0 0 24 24" width="28" height="28" fill="#C19A6B"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
          </span>
          <div>
            <span class="brand-name">صيدات العود</span>
            <span class="brand-sub" style="display:block;font-size:0.7rem;opacity:0.5;">لوحة الإدارة</span>
          </div>
        </a>
      </div>

      <div class="sidebar-user">
        <div class="sidebar-avatar" id="adminAvatar">م</div>
        <div class="sidebar-user-info">
          <span class="sidebar-user-name" id="adminName">مدير النظام</span>
          <span class="admin-badge">مدير الموقع</span>
        </div>
      </div>

      <div class="sidebar-nav">
        <div class="nav-section-title">القائمة الرئيسية</div>
        <a class="nav-item active" data-section="dashboard" onclick="switchSection('dashboard')">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
          <span>لوحة القيادة</span>
        </a>
        <a class="nav-item" data-section="users" onclick="switchSection('users')">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
          <span>إدارة المستخدمين</span>
        </a>
        <a class="nav-item" data-section="products" onclick="switchSection('products')">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/></svg>
          <span>إدارة المنتجات</span>
        </a>
        <a class="nav-item" data-section="orders" onclick="switchSection('orders')">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
          <span>إدارة الطلبات</span>
        </a>

        <div class="nav-section-title">الإدارة المالية</div>
        <a class="nav-item" data-section="finance" onclick="switchSection('finance')">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
          <span>المالية</span>
        </a>

        <div class="nav-section-title">الإعدادات</div>
        <a class="nav-item" data-section="settings" onclick="switchSection('settings')">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
          <span>إعدادات الموقع</span>
        </a>
      </div>

      <div class="sidebar-footer">
        <a class="nav-item" onclick="AUTH.logout()">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
          <span>تسجيل الخروج</span>
        </a>
      </div>
    </aside>

    <!-- ===== MAIN CONTENT ===== -->
    <main class="main-content">
      <div class="content-header">
        <h1 id="pageTitle">لوحة القيادة</h1>
        <div class="header-actions-bar">
          <a href="index.html" class="btn btn-outline btn-sm">العودة للموقع</a>
        </div>
      </div>

      <div class="content-body">

        <!-- ===== القسم 1: لوحة القيادة ===== -->
        <div class="section-panel active" id="section-dashboard">
          <div class="stats-grid admin-stats" id="adminStatsGrid"></div>

          <div class="admin-grid-2">
            <div class="chart-card">
              <div class="chart-title">المبيعات الشهرية (جميع التجار)</div>
              <div class="bar-chart" id="adminBarChart"></div>
            </div>
            <div class="activity-feed">
              <div class="activity-feed-title">آخر النشاطات</div>
              <div id="activityFeed"></div>
            </div>
          </div>

          <div class="table-card">
            <div class="table-header">
              <span class="table-title">آخر الطلبات</span>
              <button class="btn btn-outline btn-sm" onclick="switchSection('orders')">عرض الكل</button>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>رقم الطلب</th>
                    <th>المنتج</th>
                    <th>البائع</th>
                    <th>المشتري</th>
                    <th>المبلغ</th>
                    <th>العمولة</th>
                    <th>الحالة</th>
                    <th>التاريخ</th>
                  </tr>
                </thead>
                <tbody id="adminRecentOrdersBody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ===== القسم 2: إدارة المستخدمين ===== -->
        <div class="section-panel" id="section-users">
          <div class="table-card">
            <div class="table-header">
              <span class="table-title">إدارة المستخدمين</span>
              <div class="admin-search">
                <input type="text" class="form-input" id="userSearch" placeholder="بحث بالاسم أو البريد..." oninput="renderUsers()">
                <select class="form-select" id="userRoleFilter" onchange="renderUsers()">
                  <option value="all">جميع الأدوار</option>
                  <option value="seller">تاجر</option>
                  <option value="admin">مدير</option>
                </select>
                <select class="form-select" id="userStatusFilter" onchange="renderUsers()">
                  <option value="all">جميع الحالات</option>
                  <option value="active">نشط</option>
                  <option value="suspended">معلّق</option>
                </select>
              </div>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>المستخدم</th>
                    <th>البريد الإلكتروني</th>
                    <th>الدور</th>
                    <th>الحالة</th>
                    <th>المنتجات</th>
                    <th>الإيرادات</th>
                    <th>تاريخ التسجيل</th>
                    <th>إجراءات</th>
                  </tr>
                </thead>
                <tbody id="usersBody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ===== القسم 3: إدارة المنتجات ===== -->
        <div class="section-panel" id="section-products">
          <div id="productApprovalTabs" style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;">
            <button class="tab-btn active" data-filter="all" onclick="filterProductApproval('all')">الكل</button>
            <button class="tab-btn" data-filter="pending" onclick="filterProductApproval('pending')">بانتظار الموافقة <span class="count-badge" id="pendingProductsCount" style="background:#F39C12;color:#fff;border-radius:10px;padding:1px 7px;font-size:0.72rem;margin-right:4px">0</span></button>
            <button class="tab-btn" data-filter="approved" onclick="filterProductApproval('approved')">معتمد</button>
            <button class="tab-btn" data-filter="rejected" onclick="filterProductApproval('rejected')">مرفوض</button>
          </div>
          <div class="table-card">
            <div class="table-header">
              <span class="table-title">إدارة المنتجات</span>
              <div class="admin-search">
                <input type="text" class="form-input" id="productSearch" placeholder="بحث بالاسم..." oninput="renderProducts()">
                <select class="form-select" id="productTypeFilter" onchange="renderProducts()">
                  <option value="all">جميع الأنواع</option>
                  <option value="market">سوق</option>
                  <option value="auction">مزاد</option>
                </select>
                <select class="form-select" id="productStatusFilter" onchange="renderProducts()">
                  <option value="all">جميع الحالات</option>
                  <option value="active">نشط</option>
                  <option value="inactive">متوقف</option>
                </select>
              </div>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>المنتج</th>
                    <th>البائع</th>
                    <th>النوع</th>
                    <th>التصنيف</th>
                    <th>السعر</th>
                    <th>المخزون</th>
                    <th>الحالة</th>
                    <th>الموافقة</th>
                    <th>إجراءات</th>
                  </tr>
                </thead>
                <tbody id="adminProductsBody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ===== القسم 4: إدارة الطلبات ===== -->
        <div class="section-panel" id="section-orders">
          <div class="tabs" id="adminOrderTabs">
            <button class="tab-btn active" data-tab="all" onclick="filterAdminOrders('all')">الكل <span class="count" id="adminCountAll">0</span></button>
            <button class="tab-btn" data-tab="new" onclick="filterAdminOrders('new')">جديدة <span class="count" id="adminCountNew">0</span></button>
            <button class="tab-btn" data-tab="processing" onclick="filterAdminOrders('processing')">قيد المعالجة <span class="count" id="adminCountProcessing">0</span></button>
            <button class="tab-btn" data-tab="completed" onclick="filterAdminOrders('completed')">مكتملة <span class="count" id="adminCountCompleted">0</span></button>
            <button class="tab-btn" data-tab="cancelled" onclick="filterAdminOrders('cancelled')">ملغاة <span class="count" id="adminCountCancelled">0</span></button>
          </div>
          <div class="table-card">
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>رقم الطلب</th>
                    <th>المنتج</th>
                    <th>البائع</th>
                    <th>المشتري</th>
                    <th>المبلغ</th>
                    <th>العمولة (5%)</th>
                    <th>الحالة</th>
                    <th>التاريخ</th>
                    <th>إجراءات</th>
                  </tr>
                </thead>
                <tbody id="adminOrdersBody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ===== القسم 5: المالية ===== -->
        <div class="section-panel" id="section-finance">
          <div class="stats-grid" id="financeStatsGrid"></div>

          <div class="table-card" style="margin-bottom:24px;">
            <div class="table-header">
              <span class="table-title">سجل العمولات</span>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>التاريخ</th>
                    <th>البائع</th>
                    <th>رقم الطلب</th>
                    <th>مبلغ البيع</th>
                    <th>العمولة</th>
                    <th>الحالة</th>
                  </tr>
                </thead>
                <tbody id="commissionBody"></tbody>
              </table>
            </div>
          </div>

          <div class="table-card">
            <div class="table-header">
              <span class="table-title">طلبات السحب</span>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>التاريخ</th>
                    <th>البائع</th>
                    <th>البنك</th>
                    <th>المبلغ</th>
                    <th>الحالة</th>
                    <th>إجراءات</th>
                  </tr>
                </thead>
                <tbody id="withdrawalsBody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ===== القسم 6: إعدادات الموقع ===== -->
        <div class="section-panel" id="section-settings">
          <div class="settings-card">
            <div class="settings-card-title">
              <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58z"/></svg>
              إعدادات عامة
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">اسم الموقع</label>
                <input type="text" class="form-input" id="settingSiteName" value="صيدات العود">
              </div>
              <div class="form-group">
                <label class="form-label">البريد الإلكتروني للتواصل</label>
                <input type="email" class="form-input" id="settingContactEmail" value="info@saidat.com">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">نسبة العمولة (%)</label>
                <input type="number" class="form-input" id="settingCommission" value="5" min="0" max="100" step="0.5">
              </div>
              <div class="form-group">
                <label class="form-label">عملة الموقع</label>
                <input type="text" class="form-input" value="ريال سعودي (ر.س)" disabled>
              </div>
            </div>
          </div>

          <div class="settings-card">
            <div class="settings-card-title">
              <svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
              السياسات
            </div>
            <div class="form-group">
              <label class="form-label">شروط الاستخدام</label>
              <textarea class="form-textarea" id="settingTerms" style="min-height:120px;width:100%;padding:12px;border:1.5px solid var(--border-taupe);border-radius:var(--radius-btn);font-family:'IBM Plex Sans Arabic',sans-serif;font-size:0.88rem;resize:vertical;">يجب على جميع المستخدمين الالتزام بشروط الاستخدام. يُمنع بيع المنتجات المغشوشة أو غير الأصلية. تحتفظ المنصة بحق تعليق أي حساب يخالف الشروط.</textarea>
            </div>
            <div class="form-group">
              <label class="form-label">سياسة الإرجاع</label>
              <textarea class="form-textarea" id="settingReturnPolicy" style="min-height:120px;width:100%;padding:12px;border:1.5px solid var(--border-taupe);border-radius:var(--radius-btn);font-family:'IBM Plex Sans Arabic',sans-serif;font-size:0.88rem;resize:vertical;">يحق للمشتري إرجاع المنتج خلال 3 أيام من الاستلام في حال عدم مطابقة المنتج للوصف. يتحمل المشتري تكاليف الشحن في حالة الإرجاع بدون سبب.</textarea>
            </div>
          </div>

          <div style="display: flex; gap: 12px; justify-content: flex-start;">
            <button class="btn btn-primary" onclick="saveSettings()">حفظ الإعدادات</button>
            <button class="btn btn-outline" onclick="loadSettings()">إلغاء التغييرات</button>
          </div>
        </div>

      </div><!-- /content-body -->
    </main>
  </div><!-- /dashboard-layout -->

  <!-- ===== MODALS ===== -->

  <!-- User Detail Modal -->
  <div class="modal-overlay" id="userDetailModal">
    <div class="modal" style="max-width:620px;">
      <div class="modal-header">
        <h2>تفاصيل المستخدم</h2>
        <button class="modal-close" onclick="closeModal('userDetailModal')">&#10005;</button>
      </div>
      <div class="modal-body" id="userDetailBody"></div>
      <div class="modal-footer" id="userDetailFooter"></div>
    </div>
  </div>

  <!-- Order Detail Modal -->
  <div class="modal-overlay" id="orderDetailModal">
    <div class="modal" style="max-width:700px;">
      <div class="modal-header">
        <h2>تفاصيل الطلب</h2>
        <button class="modal-close" onclick="closeModal('orderDetailModal')">&#10005;</button>
      </div>
      <div class="modal-body" id="orderDetailBody"></div>
      <div class="modal-footer">
        <button class="btn btn-outline btn-sm" onclick="closeModal('orderDetailModal')">إغلاق</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/supabase.js?v=3"></script>
  <script src="js/config.js?v=3"></script>
  <script src="js/utils.js?v=3"></script>
  <script src="js/auth.js?v=6"></script>
  <script src="js/profiles.js?v=3"></script>
  <script src="js/products.js?v=3"></script>
  <script src="js/orders.js?v=3"></script>
  <script src="js/transactions.js?v=3"></script>
  <script src="js/admin-api.js?v=3"></script>
  <script src="js/header.js?v=3"></script>
  <script src="js/ui.js?v=3"></script>
  <script src="js/admin-app.js?v=4"></script>
</body>
</html>
